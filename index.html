<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Hub - Home</title>
    <style>
        /* বেসিক স্টাইল */
        body { font-family: sans-serif; background-color: #121212; color: white; margin: 0; }
        header { background-color: #1f1f1f; padding: 15px; text-align: center; border-bottom: 2px solid #7597de; }
        .post-link { 
            display: block; 
            padding: 15px; 
            border-bottom: 1px solid #333; 
            text-decoration: none; 
            color: white;
            transition: background-color 0.2s;
        }
        .post-link:hover { background-color: #222; }
        .list-container { max-width: 700px; margin: 20px auto; padding: 0 10px; }

        /* iframe কন্টেইনার স্টাইল (যা পোস্টের বিস্তারিত দেখাবে) */
        #postDetailsIframeContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #121212; /* ডার্ক ব্যাকগ্রাউন্ড */
            z-index: 9999; /* সবার উপরে রাখার জন্য */
            overflow: auto; /* স্ক্রল করার জন্য */
            display: none; /* ডিফল্টভাবে লুকানো থাকবে */
        }

        #postIframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Iframe বন্ধ করার বাটন */
        #closeIframeBtn {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 10000;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            line-height: 40px;
            text-align: center;
        }
    </style>
</head>
<body>
    <header>
        <h1>AI Prompt Hub</h1>
        <p>AI Avatar: <img id="adminAvatarImg" src="https://via.placeholder.com/36" width="36" height="36" style="border-radius: 50%; vertical-align: middle;"></p>
    </header>
    
    <main id="appContent">
        <div id="listContainer" class="list-container">
            <h2>Latest Prompts</h2>
            </div>

        <div id="postDetailsIframeContainer">
            <button id="closeIframeBtn" onclick="closePost()">X</button>
            <iframe id="postIframe" title="Post Details"></iframe>
        </div>
    </main>

    <script>
        const appContent = document.getElementById('listContainer');
        
        // *** আপনার সঠিক API Endpoint ***
        const API_ENDPOINT = 'https://ambylxvsxgxfgzpxzwpr.supabase.co/functions/v1/bright-worker';

        // --- পোস্টের বিস্তারিত দেখার লজিক (iframe নিয়ন্ত্রণ) ---
        function openPost(slug) {
            // ১. পোস্টের তালিকা লুকানো
            document.getElementById('listContainer').style.display = 'none';
            // ২. iframe কন্টেইনার দেখানো
            document.getElementById('postDetailsIframeContainer').style.display = 'block';
            // ৩. iframe এ post.html লোড করা, সাথে স্লাগ প্যারামিটার
            document.getElementById('postIframe').src = `post.html?view=${slug}`;
            // ৪. বাটন দেখানো
            document.getElementById('closeIframeBtn').style.display = 'block';
        }

        // --- পোস্ট ভিউ বন্ধ করার লজিক ---
        function closePost() {
            // ১. iframe কন্টেইনার লুকানো
            document.getElementById('postDetailsIframeContainer').style.display = 'none';
            // ২. পোস্টের তালিকা দেখানো
            document.getElementById('listContainer').style.display = 'block';
            // ৩. iframe src মুছে ফেলা
            document.getElementById('postIframe').src = ''; 
            document.getElementById('closeIframeBtn').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // --- ডেটা লোড করে হোমপেজ রেন্ডার করা ---
        async function fetchData() {
            try {
                const response = await fetch(API_ENDPOINT);
                if (!response.ok) throw new Error('Failed to fetch data.');
                const data = await response.json();
                
                if (data.avatar) {
                    document.getElementById('adminAvatarImg').src = data.avatar;
                }
                
                renderHomePage(data.prompts);

            } catch (error) {
                appContent.innerHTML = `<h1>Error Loading Application: ${error.message}</h1>`;
                console.error("Initialization Error:", error);
            }
        }

        function renderHomePage(prompts) {
            document.title = "AI Prompt Hub";
            appContent.innerHTML = '<h2>Latest Prompts</h2>';
            
            if (prompts) {
                Object.entries(prompts).reverse().forEach(([key, item]) => {
                    const postSlug = item.title.toLowerCase().trim().replace(/[^a-z0-9\s-]/g, '').replace(/[\s]+/g, '-');
                    
                    appContent.innerHTML += `
                        <a href="javascript:void(0)" onclick="openPost('${postSlug}')" class="post-link">
                            ${item.title} <span style="float:right;">(${item.rating} ★)</span>
                        </a>
                    `;
                });
            } else {
                appContent.innerHTML = "<p style='text-align:center;'>No prompts found.</p>";
            }
        }

        // --- রাউটিং শুরু ---
        // যেহেতু আপনি এখন iframe ব্যবহার করছেন, URL এ ?view থাকলেও সরাসরি তালিকা দেখাবে।
        // তবে যদি আপনি চান যে শেয়ার করা লিংক সরাসরি পোস্টে খুলুক, তাহলে
        // URL চেক করার লজিক দরকার। কিন্তু iframe লজিক সহজে URL পরিবর্তন করে না।
        // আমরা এখন শুধুমাত্র তালিকা লোড করব।
        
        fetchData();
    </script>
</body>
</html>
